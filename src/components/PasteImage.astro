---
---

<div
  id="pasteArea"
  class="w-full h-[200px] min-h-[200px] max-h-[200px] border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center cursor-pointer relative focus:outline-none focus:border-blue-400 transition-colors duration-200"
  tabindex="0"
>
  <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-gray-400 text-center pointer-events-none">
    请在此区域粘贴或拖放图片
  </div>
</div>

<script>
  function initPasteArea() {
    const pasteAreas = document.querySelectorAll('[id="pasteArea"]');
    
    pasteAreas.forEach(pasteArea => {
      const instructions = pasteArea.querySelector('div');

      function handleImageURL(url) {
        if (instructions) {
          instructions.remove();
        }
        
        const img = document.createElement('img');
        img.src = url;
        img.alt = "已添加的图片";
        img.className = "h-[200px] w-auto object-contain";
        
        const existingImg = pasteArea.querySelector('img');
        if (existingImg) {
          existingImg.remove();
        }
        
        pasteArea.appendChild(img);
        pasteArea.classList.remove('border-2', 'border-dashed', 'border-gray-300');
      }

      function handleImage(file: File) {
        const reader = new FileReader();
        reader.onload = (event) => {
          handleImageURL(event.target?.result as string);
        };
        reader.readAsDataURL(file);
      }

      const handlePaste = (e: ClipboardEvent) => {
        const items = e.clipboardData?.items;
        if (!items) return;

        for (const item of items) {
          if (item.type.includes('image')) {
            const file = item.getAsFile();
            if (file) {
              handleImage(file);
              e.preventDefault();
              break;
            }
          }
        }
      };

      const handleDragOver = (e: DragEvent) => {
        e.preventDefault();
        pasteArea.classList.add('border-blue-400', 'bg-blue-50');
      };

      const handleDragLeave = (e: DragEvent) => {
        e.preventDefault();
        pasteArea.classList.remove('border-blue-400', 'bg-blue-50');
      };

      const handleDrop = (e: DragEvent) => {
        e.preventDefault();
        pasteArea.classList.remove('border-blue-400', 'bg-blue-50');
        
        const files = e.dataTransfer?.files;
        const url = e.dataTransfer?.getData('text/plain');
        
        if (files && files.length > 0) {
          for (const file of files) {
            if (file.type.includes('image')) {
              handleImage(file);
              break;
            }
          }
        } else if (url) {
          handleImageURL(url);
        }
      };

      pasteArea.addEventListener('paste', handlePaste as EventListener);
      pasteArea.addEventListener('dragover', handleDragOver);
      pasteArea.addEventListener('dragleave', handleDragLeave);
      pasteArea.addEventListener('drop', handleDrop);
      pasteArea.addEventListener('click', () => pasteArea.focus());
    });
  }

  document.addEventListener('DOMContentLoaded', initPasteArea);
  document.addEventListener('astro:page-load', initPasteArea);
</script>
